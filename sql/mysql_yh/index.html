<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="朽木自雕">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>MySQL优化 - BurningMyself</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "MySQL\u4f18\u5316";
    var mkdocs_page_input_path = "sql\\mysql_yh.md";
    var mkdocs_page_url = "/sql/mysql_yh/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> BurningMyself</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">介绍</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">技术博文</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">.NET</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../net/c_sharp/">C# 6</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../net/c_docker/">.Ner Core Docker 部署</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../net/c_mysql_nginx/">使用 Docker 容器化部署 ASP.NET Core + MySQL + Nginx</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../net/c_core_safety/">让你的ASP.NET Core应用程序更安全</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../net/c_core_study_route/">ASP.NET Core开发者指南</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Java</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../java/feature/">Java特性</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../java/load-class/">Java类加载</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../java/orm/">Orm的优缺点</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../java/bio-nio/">BIO与NIO</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../java/rocketmq/rmq-1/">RocketMq下载与安装</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../java/springAnnotation/">Spring常用注解</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Python</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../python/feature/">Python特性</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/str_joint/">Python字符拼接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/syntax_rule/">Python语法技巧</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/fabric/">远程部署神器 Fabric</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">PHP</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../php/kj/">框架</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Web</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../web/es6/">es6语法</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/ali_js_style/">阿里js样式规范</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/node.js/">node.js文档</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/react/">React 开发者指南</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../dart/syntax/">Dart语法学习</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/react_interview/">React 面试</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/js_tool_method/">js 工具函数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../web/vue_cp_react/">vue与react比较</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <span class="caption-text">SQL</span>
    <ul class="subnav">
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">MySQL优化</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#mysql">MySQL 优化指南</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#_1">慢查询日志 开启撒网模式</a></li>
        
            <li><a class="toctree-l5" href="#mysql_1">编辑MySQL的配置文件：</a></li>
        
            <li><a class="toctree-l5" href="#mysql_2">重启MySQL</a></li>
        
            <li><a class="toctree-l5" href="#_2">服务器开一个监控：</a></li>
        
            <li><a class="toctree-l5" href="#sql">客户端走一条SQL：</a></li>
        
            <li><a class="toctree-l5" href="#explain">EXPLAIN 点对点分析</a></li>
        
            <li><a class="toctree-l5" href="#select_typeselect">select_type：表示select类型 取值如下</a></li>
        
            <li><a class="toctree-l5" href="#typemysqltype">type：表示MySQL在表中查找数据的方式，或者叫访问类型，以下对于type取值的说明 从上往下性能由最差到最好</a></li>
        
            <li><a class="toctree-l5" href="#possible_keys">possible_keys：表示查询时可能使用的索引</a></li>
        
            <li><a class="toctree-l5" href="#key">key：表示实际使用的索引</a></li>
        
            <li><a class="toctree-l5" href="#key_len">key_len：使用到索引字段的长度</a></li>
        
            <li><a class="toctree-l5" href="#rows">rows：扫描数量</a></li>
        
            <li><a class="toctree-l5" href="#extra">Extra：执行情况的说明和描述，包含不适合在其他列中显示但是对执行计划非常重要的额外信息，常用取值如下：</a></li>
        
            <li><a class="toctree-l5" href="#count">优化争议无数的count()</a></li>
        
            <li><a class="toctree-l5" href="#_3">统计列与统计行？</a></li>
        
            <li><a class="toctree-l5" href="#myisam">解密MyiSAM的‘快’</a></li>
        
            <li><a class="toctree-l5" href="#count1countcount">COUNT(1)、COUNT(*)、COUNT(列)</a></li>
        
            <li><a class="toctree-l5" href="#order-by">优化order by 语句</a></li>
        
            <li><a class="toctree-l5" href="#mysql_3">MySQL的排序方式</a></li>
        
            <li><a class="toctree-l5" href="#filesort">filesort的优化</a></li>
        
            <li><a class="toctree-l5" href="#group-by">优化group by 语句</a></li>
        
            <li><a class="toctree-l5" href="#order-bygroup-by">为什么order by后面不能跟group by</a></li>
        
            <li><a class="toctree-l5" href="#_4">禁止排序</a></li>
        
            <li><a class="toctree-l5" href="#limit">优化limit 分页</a></li>
        
            <li><a class="toctree-l5" href="#_5">第一种思路 在索引上分页</a></li>
        
            <li><a class="toctree-l5" href="#limit_1">第二种思路 将limit转换成位置查询</a></li>
        
            <li><a class="toctree-l5" href="#_6">优化子查询</a></li>
        
            <li><a class="toctree-l5" href="#_7">改变执行计划</a></li>
        
            <li><a class="toctree-l5" href="#_8">提高索引优先级</a></li>
        
            <li><a class="toctree-l5" href="#_9">忽略索引</a></li>
        
            <li><a class="toctree-l5" href="#_10">强制使用索引</a></li>
        
            <li><a class="toctree-l5" href="#_11">个人分享</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../mysql_yh17/">MySQL优化</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../mysql_log/">MySQL日志</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../mysql_index/">MySQL索引</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../mysql_pxc/">MySQL PXC集群</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../mysql_use/">MySQL 数据库应用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../sql_server_master/">Sql Server 主从备份</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../data_split/">数据库之互联网常用分库分表方案</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../mybatis/">Mybatis使用心德</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Linux</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../linux/often/">常用命令</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../linux/ope/">实用的Linux 命令</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Docker</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../docker/docker/">Docker全科</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../docker/docker-compose/">docker和docker-compose 配置 mysql mongodb redis nginx jenkins 环境</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../docker/docker-jenkins/">Docker部署Jenkins</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Tool</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/git/">Git</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/gitquestion/">Git问题处理</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/gitflow/">GitFlow</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/gitbook/">GitBook</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/gitcmr/">Git提交日志规范</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/markdown/">Markdown</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/cicd/">CI/CD</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/mkdocs/">mkdocs简单使用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tool/gitstudy/">Git的黑魔法</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">微服务</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../micro/spring-cloud/">基于SpringCloud的微服务架构演变史</a>
                </li>
                <li class="">
                    
    <a class="" href="../../micro/fbs-lock/">分布式锁</a>
                </li>
                <li class="">
                    
    <a class="" href="../../micro/design/">微服务设计</a>
                </li>
                <li class="">
                    
    <a class="" href="../../micro/distrimsg/">分布式系统与消息的投递</a>
                </li>
                <li class="">
                    
    <a class="" href="../../micro/ddd/">基于DDD的微服务设计和开发实战</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">经验分析</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../exp/devops/">DevOps</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/micro-service/">Micro-Service</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/raft-gossip/">Raft算法和Gossip协议</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/cl/">集群和负载均衡</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/ai/">人工智能</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/code-principle/">代码原则</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/techbig/">如何成为技术大牛</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/learnweetout/">程序员如何技术成长</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/pt/">产品与技术</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/four_deep_learning/">深度学习框架</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/tl/">在阿里做了5年技术Leader，我总结出这些套路！</a>
                </li>
                <li class="">
                    
    <a class="" href="../../exp/cto/">CTO 技能图谱</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">医学</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../doctor/ae/">脑炎</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">构架</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../framework/split/">构架拆分</a>
                </li>
                <li class="">
                    
    <a class="" href="../../framework/fgb/">分布式、高并发、多线程</a>
                </li>
                <li class="">
                    
    <a class="" href="../../framework/agility/">如何理解敏捷开发</a>
                </li>
                <li class="">
                    
    <a class="" href="../../framework/fwork/">走向架构师必备的技能</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">情感</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../emotion/eq/">情商</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/workheard/">工作心得</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/lookbook/">看书</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/fmf/">4种男朋友</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/notheart/">不上心</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/selfdiscipline/">自律</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/notlike/">喜欢与不喜欢</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/latemarry/">晚婚</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/understand/">追女生要明白这些事</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/backup/">备胎</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/chase/">为什么追不到她</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/livefail/">为什么活着失败</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/emotion/">情绪管理</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/abolish/">废掉的三个迹象</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/uptime/">余生，好好珍惜</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/losecome/">所有的失去，都会以另一种方式归来</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/threeheart/">人生有这三种好心态</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/onelike/">一个感情真相</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/notruth/">情商与道理</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/smf/">六种男人远离</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/select/">决定接下来人生归属的，不是努力，而是选择</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/nolike/">被你拉黑的那个人，你一定很喜欢吧</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/onepath/">余生，学会一个人走，不管有没有人陪</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/twopath/">往后余生还很精彩，别被熬夜拖垮了</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/lifetime/">心态好的人，一辈子都好</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/hearttoheart/">将心比心，方得人心</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/ttt/">别睡太晚，别爱太满，别要太多</a>
                </li>
                <li class="">
                    
    <a class="" href="../../emotion/profess/">表白</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">BurningMyself</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>SQL &raquo;</li>
        
      
        
          <li>技术博文 &raquo;</li>
        
      
    
    <li>MySQL优化</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/burningmyself/burningmyself.github.io/edit/master/docs/sql/mysql_yh.md"> Edit on burningmyself/blog</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="mysql">MySQL 优化指南<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h1>
<h2 id="_1">慢查询日志 开启撒网模式<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>开启了MySQL慢查询日志之后，MySQL会自动将执行时间超过指定秒数的SQL统统记录下来，这对于搜罗线上慢SQL有很大的帮助。</p>
<pre class="codehilite"><code class="language-sql">SHOW VARIABLES LIKE 'slow%'</code></pre>


<p>以我刚安装的mysql5.7为例 查询结果是这样子的：</p>
<p><img alt="sql" src="../../img/sql1.png" title="sql_show" /></p>
<ol>
<li>slow_launch_time：表示如果建立线程花费了比这个值更长的时间,slow_launch_threads 计数器将增加</li>
<li>slow_query_log：是否开启慢查询日志 ON开启，OFF关闭 默认没有开启</li>
<li>slow_query_log_file：日志保存路径</li>
</ol>
<pre class="codehilite"><code class="language-sql">SHOW VARIABLES LIKE 'long%'</code></pre>


<p><img alt="sql" src="../../img/sql2.png" /></p>
<p>long_query_time：达到多少秒的sql就记录日志</p>
<p>客户端可以用set设置变量的方式让慢查询开启，但是个人不推荐，因为真实操作起来会有一些问题，比如说，重启MySQL后就失效了，或者是开启了慢查询，我又去改变量值，它就不生效了。</p>
<h2 id="mysql_1">编辑MySQL的配置文件：<a class="headerlink" href="#mysql_1" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code class="language-shell">vim /etc/my.cnf</code></pre>


<p>加入如下三行：</p>
<pre class="codehilite"><code class="language-config">slow_query_log=ON
slow_query_log_file=/var/lib/mysql/localhost-centos-slow.log
long_query_time=3</code></pre>


<p>我这里设置的是3秒</p>
<h2 id="mysql_2">重启MySQL<a class="headerlink" href="#mysql_2" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code class="language-shell">systemctl restart mysqld;</code></pre>


<h2 id="_2">服务器开一个监控：<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code class="language-shell">tail -f /var/lib/mysql/localhost-centos-slow.log</code></pre>


<h2 id="sql">客户端走一条SQL：<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h2>
<pre class="codehilite"><code class="language-sql">SELECT SLEEP(3)</code></pre>


<p>此时发现sql已经被记录到日志里了。（有时候不一定，我看到很多博客讲的是超过指定秒数，但我实验得出的结果是达到指定秒数）</p>
<h2 id="explain">EXPLAIN 点对点分析<a class="headerlink" href="#explain" title="Permanent link">&para;</a></h2>
<p>explain是一个神奇的命令，可以查看sql的具体的执行计划。</p>
<p>以一条联查sql为例：</p>
<pre class="codehilite"><code class="language-sql">SELECT a.id,a.cn_name,a.role_id,r.name
FROM tb_usr_admins a
INNER JOIN tb_base_roles r ON r.id=a.role_id
WHERE a.cn_name=&quot;接单人员&quot;</code></pre>


<p>查询结果是：
<img alt="sql" src="../../img/sql3.png" title="sql" /></p>
<p>加上explain命令来执行：</p>
<pre class="codehilite"><code class="language-sql">EXPLAIN
SELECT a.id,a.cn_name,a.role_id,r.name
FROM tb_usr_admins a
INNER JOIN tb_base_roles r ON r.id=a.role_id
WHERE a.cn_name=&quot;接单人员&quot;</code></pre>


<p>查询结果是：
<img alt="sql" src="../../img/sql4.png" title="sql" /></p>
<p>这就是这条SQL的执行计划，下面来说明一下这个执行计划怎么看</p>
<p>id：代表优先级  id值越大，越先执行，id值相同，从上往下执行。（比如示例的这条sql的执行计划，就是先执行第一行，再执行第二行）</p>
<h2 id="select_typeselect">select_type：表示select类型 取值如下<a class="headerlink" href="#select_typeselect" title="Permanent link">&para;</a></h2>
<ul>
<li>simple 简单表 即不使用表连接或者子查询</li>
<li>primary 包含union或者子查询的主查询 即外层的查询</li>
<li>union UNION中的第二个或者后面的查询语句</li>
<li>subquery 一般子查询中的子查询被标记为subquery，也就是位于select列表中的查询</li>
<li>derived 派生表 该临时表是从子查询派生出来的</li>
<li>等等</li>
</ul>
<h2 id="typemysqltype">type：表示MySQL在表中查找数据的方式，或者叫访问类型，以下对于type取值的说明 从上往下性能由最差到最好<a class="headerlink" href="#typemysqltype" title="Permanent link">&para;</a></h2>
<ol>
<li>all:全表扫描，MySQL遍历全表来找到匹配的行</li>
<li>index：索引全扫描，MySQL遍历挣个索引来查询匹配的行</li>
<li>range：索引范围扫描，常见于&lt;、&lt;=、&gt;、&gt;=、between等操作符</li>
<li>ref：使用非唯一索引或唯一索引的前缀扫描，返回匹配的单行数据</li>
<li>eq_ref：类似ref，区别就在于使用的索引是唯一索引，简单来说，就是多表连接中使用primary key或者unique index作为关联条件。</li>
<li>const/system：单表中最多有一个匹配行，查询起来非常迅速，常见于根据primary key或者唯一索引unique index进行的单表查询</li>
<li>null：mysql不用访问表或者索引，直接就能够得到查询的结果，例如select 1+2 as result。</li>
</ol>
<h2 id="possible_keys">possible_keys：表示查询时可能使用的索引<a class="headerlink" href="#possible_keys" title="Permanent link">&para;</a></h2>
<h2 id="key">key：表示实际使用的索引<a class="headerlink" href="#key" title="Permanent link">&para;</a></h2>
<h2 id="key_len">key_len：使用到索引字段的长度<a class="headerlink" href="#key_len" title="Permanent link">&para;</a></h2>
<h2 id="rows">rows：扫描数量<a class="headerlink" href="#rows" title="Permanent link">&para;</a></h2>
<h2 id="extra">Extra：执行情况的说明和描述，包含不适合在其他列中显示但是对执行计划非常重要的额外信息，常用取值如下：<a class="headerlink" href="#extra" title="Permanent link">&para;</a></h2>
<ul>
<li>Using index：直接访问索引就取到了数据，高性能的表现。</li>
<li>Using where：直接在主键索引上过滤数据，必带where子句，而且用不上索引</li>
<li>Using index condition：先条件过滤索引，再查数据，</li>
<li>Using filesort：使用了外部文件排序 只要见到这个 就要优化掉</li>
<li>Using temporary：创建了临时表来处理查询 只要见到这个 也要尽量优化掉</li>
</ul>
<h2 id="count">优化争议无数的count()<a class="headerlink" href="#count" title="Permanent link">&para;</a></h2>
<h2 id="_3">统计列与统计行？<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>COUNT()是一个特殊的函数，有两种不同的作用，它可以统计某个列值的数量，也可以统计行数。</p>
<p>在统计列值的时候要求列值是非空的，也就是不统计null。</p>
<p>当我们统计行的时候，常见的是COUNT(<em>)，这种情况下，通配符</em>并不会像我们猜想的那样扩展成所有的列，实际上，它会忽略所有的列而直接统计所有的行数</p>
<h2 id="myisam">解密MyiSAM的‘快’<a class="headerlink" href="#myisam" title="Permanent link">&para;</a></h2>
<p>这是一个容易产生误解的事情：MyiSAM的count()函数总是非常快。</p>
<p>不过它是有前提条件的，条件是没有任何where条件的count(<em>)才非常快，因为此时无须实际的去计算表的行数，mysql可以利用存储引擎的特性直接获得这个值，如果mysql知道某列不可能有null值，那么mysql内部会将count(列)表达式优化为count(</em>)。</p>
<p>当统计带有where条件的查询，那么mysql的count()和其他存储引擎就没有什么不同了。</p>
<h2 id="count1countcount">COUNT(1)、COUNT(*)、COUNT(列)<a class="headerlink" href="#count1countcount" title="Permanent link">&para;</a></h2>
<p>（先提前申明，本人是在innodb库里做的实验。）</p>
<ol>
<li>
<p>count(1)和count(*)直接就是统计主键，他们两个的效率是一样的。如果删除主键，他们都走全表扫描。</p>
</li>
<li>
<p>如果count(列)中的字段是索引的话，count(列)和count(*)一样快，否则count(列)走全表扫描。</p>
</li>
</ol>
<h2 id="order-by">优化order by 语句<a class="headerlink" href="#order-by" title="Permanent link">&para;</a></h2>
<h2 id="mysql_3">MySQL的排序方式<a class="headerlink" href="#mysql_3" title="Permanent link">&para;</a></h2>
<p>优化order by语句就不得不了解mysql的排序方式。</p>
<ol>
<li>
<p>第一种通过有序索引返回数据，这种方式的extra显示为Using Index,不需要额外的排序，操作效率较高。</p>
</li>
<li>
<p>第二种是对返回的数据进行排序，也就是通常看到的Using filesort，filesort是通过相应的排序算法，将数据放在sort_buffer_size系统变量设置的内存排序区中进行排序，如果内存装载不下，它就会将磁盘上的数据进行分块，再对各个数据块进行排序，然后将各个块合并成有序的结果集。</p>
</li>
</ol>
<h2 id="filesort">filesort的优化<a class="headerlink" href="#filesort" title="Permanent link">&para;</a></h2>
<p>了解了MySQL排序的方式，优化目标就清晰了：尽量减少额外的排序，通过索引直接返回有序数据。where条件和order by使用相同的索引。</p>
<ol>
<li>
<p>创建合适的索引减少filesort的出现。</p>
</li>
<li>
<p>查询时尽量只使用必要的字段，select 具体字段的名称，而不是select * 选择所有字段，这样可以减少排序区的使用，提高SQL性能。</p>
</li>
</ol>
<h2 id="group-by">优化group by 语句<a class="headerlink" href="#group-by" title="Permanent link">&para;</a></h2>
<h2 id="order-bygroup-by">为什么order by后面不能跟group by<a class="headerlink" href="#order-bygroup-by" title="Permanent link">&para;</a></h2>
<p>事实上，MySQL在所有的group by 后面隐式的加了order by ，也就是说group by语句的结果会默认进行排序。</p>
<p>如果你要在order by后面加group by ，那结果执行的SQL是不是这样：select * from tb order by … group by … order by … ？ 这不是搞笑吗？</p>
<h2 id="_4">禁止排序<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>既然知道问题了，那么就容易优化了，如果查询包括group by但又不关心结果集的顺序，而这种默认排序又导致了需要文件排序，则可以指定order by null 禁止排序。</p>
<p>例如：</p>
<pre class="codehilite"><code class="language-sql">select * from tb group by name order by null;</code></pre>


<h2 id="limit">优化limit 分页<a class="headerlink" href="#limit" title="Permanent link">&para;</a></h2>
<p>一个非常常见又非常头痛的场景：‘limit 1000,20’。</p>
<p>这时MySQL需要查询1020条记录然后只返回最后20条，前面的1000条都将被抛弃，这样的代价非常高。如果所有页面的访问频率都相同，那么这样的查询平均需要访问半个表的数据。</p>
<h2 id="_5">第一种思路 在索引上分页<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>在索引上完成分页操作，最后根据主键关联回原表查询所需要的其他列的内容。</p>
<p>例如：</p>
<pre class="codehilite"><code class="language-sql">SELECT * FROM tb_user LIMIT 1000,10</code></pre>


<p>可以优化成这样：</p>
<pre class="codehilite"><code class="language-sql">SELECT * FROM tb_user u
INNER JOIN (SELECT id FROM tb_user LIMIT 1000,10) AS b ON b.id=u.id</code></pre>


<h2 id="limit_1">第二种思路 将limit转换成位置查询<a class="headerlink" href="#limit_1" title="Permanent link">&para;</a></h2>
<p>这种思路需要加一个参数来辅助，标记分页的开始位置：</p>
<pre class="codehilite"><code class="language-sql">SELECT * FROM tb_user WHERE id &gt; 1000 LIMIT 10</code></pre>


<h2 id="_6">优化子查询<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>子查询，也就是查询中有查询，常见的是where后面跟一个括号里面又是一条查询sql</p>
<p>尽可能的使用join关联查询来代替子查询。</p>
<p>当然 这不是绝对的，比如某些非常简单的子查询就比关联查询效率高，事实效果如何还要看执行计划。</p>
<p>只能说大部分的子查询都可以优化成Join关联查询。</p>
<h2 id="_7">改变执行计划<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<h2 id="_8">提高索引优先级<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>use index 可以让MySQL去参考指定的索引，但是无法强制MySQL去使用这个索引，当MySQL觉得这个索引效率太差，它宁愿去走全表扫描。。。</p>
<pre class="codehilite"><code class="language-sql">SELECT * FROM tb_user USE INDEX (user_name)</code></pre>


<p>注意：必须是索引，不能是普通字段，（亲测主键也不行）。</p>
<h2 id="_9">忽略索引<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<p>ignore index 可以让MySQL忽略一个索引</p>
<p>SELECT * FROM tb_user IGNORE INDEX (user_name) WHERE user_name="张学友"</p>
<h2 id="_10">强制使用索引<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>使用了force index 之后 尽管效率非常低，MySQL也会照你的话去执行</p>
<pre class="codehilite"><code class="language-sql">SELECT * FROM tb_user FORCE INDEX (user_name) WHERE user_name=&quot;张学友&quot;</code></pre>


<h2 id="_11">个人分享<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<p>查看执行计划时建议依次观察以下几个要点：</p>
<ol>
<li>SQL内部的执行顺序。</li>
<li>查看select的查询类型。</li>
<li>实际有没有使用索引。</li>
<li>Extra描述信息</li>
</ol>
<p>PS:一定要养成查看执行计划的习惯，这个习惯非常重要。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mysql_yh17/" class="btn btn-neutral float-right" title="MySQL优化">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../web/vue_cp_react/" class="btn btn-neutral" title="vue与react比较"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../web/vue_cp_react/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../mysql_yh17/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
